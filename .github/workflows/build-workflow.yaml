name: Build Workflow
run-name: ğŸ› ï¸ Run build for Android & iOS
on:
  workflow_dispatch:
    inputs:
      androidBuild:
        description: "ğŸ¤– Build for Android"
        required: true
        type: boolean
        default: true
      iosBuild:
        description: "ğŸ Build for iOS"
        required: true
        type: boolean
        default: true
jobs:
  run-tests:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      #- name: Check out repository code
      #  uses: actions/checkout@v3
      #- name: Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
      #  uses: subosito/flutter-action@v2
      #  with:
      #    channel: "stable"
      #- name: Flutter Version ğŸš¦
      #  run: flutter --version
      #- name: ğŸ’¿ Get Flutter Dependencies
      #  run: flutter pub get
      #- name: âœ… Run Tests
      #  run: flutter test
      - run: echo "ğŸ¥³ Done!"
  android-build:
    name: ğŸ¤– Android Build
    if: inputs.androidBuild
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: ğŸ” Check out repository code
        uses: actions/checkout@v3
      - name: ğŸ” Check out Setup Java (https://github.com/marketplace/actions/setup-java)
        uses: actions/setup-java@v2
        with:
          distribution: "zulu"
          java-version: "11"
      - name: ğŸ” Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"

      - name: ğŸš¦ Flutter Version
        run: flutter --version
      - name: ğŸ’¿ Get Flutter Dependencies
        run: flutter pub get
      - name: ğŸ› ï¸ Build APK
        run: flutter build apk
      - name: ğŸ› ï¸ Build App Bundle
        run: flutter build appbundle

      - name: Move build files
        run: mv build/app/outputs/flutter-apk/* builds/android/

      - name: Commit build files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git commit -m "ğŸ¤– Updated Android Build" -a
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

      #- name: Commit build files to repo
      #  uses: EndBug/add-and-commit@v9
      #  with:
      #    default_author: github_actions
      #    message: "ğŸ¤– Updated Android Build"
      #    add: "builds/android/*"

      - run: echo "ğŸ¥³ Done!"
  ios-build:
    name: ğŸ iOS Build
    if: inputs.iosBuild
    runs-on: macos-latest
    needs: run-tests
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: ğŸ” Check out repository code
        uses: actions/checkout@v3
      - name: ğŸ” Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
          architecture: x64

      - name: ğŸ’¿ Get Flutter Dependencies
        run: flutter pub get
      - name: ğŸ› ï¸ Build for iOS
        run: flutter build ios --release --no-codesign

      - name: Move build files
        run: mv build/app/outputs/flutter-apk/* builds/ios/

      - run: echo "ğŸ¥³ Done!"
