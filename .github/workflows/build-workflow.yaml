name: Build Workflow
run-name: ğŸ› ï¸ Running build for Android & iOS
on:
  push:
    branches:
      - "releases/**"
  workflow_dispatch:
jobs:
  run-tests:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
      - name: Flutter Version ğŸš¦
        run: flutter --version
      - run: flutter pub get
      - name: Run Tests âœ…
        run: flutter test
      - run: echo "ğŸ¥³ Done!"
  android-build:
    name: ğŸ¤– Android Build
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: ğŸ” Check out repository code
        uses: actions/checkout@v3
      - name: ğŸ” Check out Setup Java (https://github.com/marketplace/actions/setup-java)
        uses: actions/setup-java@v2
        with:
          distribution: "zulu"
          java-version: "11"
      - name: ğŸ” Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
      - name: ğŸš¦ Flutter Version
        run: flutter --version
      - name: ğŸ’¿ Get Flutter Dependencies
        run: flutter pub get
      - name: ğŸ› ï¸ Build APK
        run: flutter build apk
      - name: ğŸ› ï¸ Build App Bundle
        run: flutter build appbundle
      - run: echo "ğŸ¥³ Done!"
  ios-build:
    name: ğŸ iOS Build
    runs-on: macos-latest
    needs: run-tests
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: ğŸ” Check out repository code
        uses: actions/checkout@v3
      - name: ğŸ” Check out Flutter Actions (https://github.com/marketplace/actions/flutter-action)
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
          architecture: x64
      - name: ğŸ’¿ Get Flutter Dependencies
        run: flutter pub get
      - name: ğŸ› ï¸ Build for iOS
        run: flutter build ios --release --no-codesign
      - run: echo "ğŸ¥³ Done!"
